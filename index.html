<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç†Šãƒ€ãƒ¡è¨ˆç®—æ©Ÿ v2.0.0</title>
    <style>
        :root {
            --font-main: -apple-system, "Hiragino Sans", "Helvetica Neue", sans-serif;
            --font-mono: "SF Mono", "Menlo", monospace;
            --main-text: #263238;
            --accent: #f8bbd0;
            --sub-accent: #51b9e9;
            --bg: #f4f7f9;
            --container-bg: #ffffff;
            --border: #b3e5fc;
            --input-bg: #ffffff;
            --header-bg: #e1f5fe;
            --dmg-color: #d81b60;
        }

        body.junk-theme {
            --main-text: #eeeeee;
            --accent: #d4af37;
            --sub-accent: #b71c1c;
            --bg: #121212;
            --container-bg: #1a1a1a;
            --border: #424242;
            --input-bg: #262626;
            --header-bg: #212121;
            --dmg-color: #ffd740;
        }

        html, body { height: 100%; overflow-x: hidden; -webkit-text-size-adjust: 100%; } 
        body { font-family: var(--font-main); font-size: 13px; color: var(--main-text); background: var(--bg); margin: 0; padding: 4px; transition: all 0.2s ease; }
        
        .container { 
            max-width: 400px; margin: auto; background: var(--container-bg); padding: 8px; 
            border-radius: 12px; display: flex; flex-direction: column; box-sizing: border-box;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        header { 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 54px; border-bottom: 3px solid var(--accent); margin-bottom: 6px; padding: 4px 10px; 
            background: var(--header-bg); border-radius: 8px 8px 0 0; 
        }
        h1 { font-size: 1.1rem; margin: 0; font-weight: 800; text-align: center; }
        .sub-title { font-size: 11px; color: var(--sub-accent); cursor: pointer; text-decoration: underline; font-weight: bold; margin-top: 2px; align-self: flex-end; }
        .ver { font-size: 14px; color: var(--accent); font-weight: bold; margin-left: 8px; opacity: 1; }

        .section { border: 1px solid var(--border); padding: 8px; margin-bottom: 6px; border-radius: 8px; background: var(--input-bg); }
        .title { font-size: 10px; font-weight: 900; border-left: 4px solid var(--sub-accent); padding-left: 6px; display: block; margin-bottom: 6px; }
        .rem-pct { font-size: 10px; font-weight: 900; color: #fff; background: var(--sub-accent); padding: 2px 8px; border-radius: 10px; }

        .grid { display: grid; grid-template-columns: 32px 65px 55px 1px 75px 75px; gap: 4px; align-items: center; margin-bottom: 4px; }
        .v-line { background: var(--border); width: 1px; height: 24px; justify-self: center; }
        .tag { background: var(--sub-accent); color: #fff; font-size: 10px; text-align: center; padding: 5px 0; border-radius: 5px; font-weight: 900; }
        
        input, select { 
            font-family: var(--font-mono); border: 1.5px solid var(--border); border-radius: 6px; 
            height: 34px; text-align: center; font-size: 14px; width: 100%; box-sizing: border-box; 
            background: var(--input-bg); color: var(--main-text); outline: none; 
        }

        input[type="range"] { -webkit-appearance: none; background: var(--border); height: 6px; border-radius: 3px; margin: 12px 0; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: var(--accent); border-radius: 50%; border: 2.5px solid #fff; }

        .u-btn { 
            background: var(--input-bg); border: 1.5px solid var(--sub-accent); padding: 5px 0; 
            font-size: 10px; border-radius: 15px; text-align: center; color: var(--sub-accent); 
            font-weight: 900; cursor: pointer;
        }
        .u-btn.active { background: var(--sub-accent); color: #fff; }

        .res-box { border: 2.5px solid var(--accent); padding: 6px 10px; border-radius: 12px; text-align: center; margin-bottom: 8px; background: rgba(248, 187, 208, 0.05); }
        #resDmg { font-family: var(--font-mono); font-size: 2rem; font-weight: 900; color: var(--dmg-color); line-height: 1.1; }

        .best-area { background: var(--sub-accent); color: #fff; padding: 8px; border-radius: 10px; text-align: center; margin-bottom: 6px; }
        .best-txt { font-size: 13px; font-weight: 900; display: block; margin-bottom: 2px; }
        .best-dmg { font-size: 11px; font-weight: 700; opacity: 0.95; font-family: var(--font-mono); }

        .reset-btn { width: 100%; padding: 10px; background: none; border: 1px solid var(--border); color: #999; border-radius: 20px; font-size: 10px; cursor: pointer; }
        
        .log-section { margin-top: 10px; border-top: 1px dashed var(--border); padding-top: 8px; }
        .log { background: rgba(128,128,128,0.04); padding: 10px; border-radius: 8px; white-space: pre-wrap; font-family: var(--font-mono); font-size: 10px; color: var(--main-text); border: 1px solid var(--border); line-height: 1.4; text-align: left; }
        .log-head { color: var(--sub-accent); font-weight: 900; margin: 6px 0 2px; display: block; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ç†Šãƒ€ãƒ¡è¨ˆç®—æ©Ÿ<span class="ver">v2.0.0</span></h1>
        <span class="sub-title" id="editionLabel" onclick="toggleEdition()">ã‚‹ã³ãƒedition</span>
    </header>

    <div class="section">
        <span class="title">å…µå£«è¨­å®š & é›†çµãƒãƒ•</span>
        <div class="grid">
            <div class="tag">ç›¾</div>
            <select id="fci" onchange="sy()"></select>
            <select id="ti" onchange="sy()"></select>
            <div class="v-line"></div>
            <input type="number" id="bAi" value="0.0" step="0.1" oninput="sy()">
            <input type="number" id="bKi" value="0.0" step="0.1" oninput="sy()">
        </div>
        <div class="grid">
            <div class="tag">æ§</div>
            <select id="fcl" onchange="sy()"></select>
            <select id="tl" onchange="sy()"></select>
            <div class="v-line"></div>
            <input type="number" id="bAl" value="0.0" step="0.1" oninput="sy()">
            <input type="number" id="bKl" value="0.0" step="0.1" oninput="sy()">
        </div>
        <div class="grid">
            <div class="tag">å¼“</div>
            <select id="fca" onchange="sy()"></select>
            <select id="ta" onchange="sy()"></select>
            <div class="v-line"></div>
            <input type="number" id="bAa" value="0.0" step="0.1" oninput="sy()">
            <input type="number" id="bKa" value="0.0" step="0.1" oninput="sy()">
        </div>
    </div>

    <div class="section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span class="title" style="margin:0;">å‡ºå¾æ•°ï¼š<span id="tDisp">100,000</span></span>
            <span id="remDisp" class="rem-pct">æ®‹ã‚Šï¼š0%</span>
        </div>
        <input type="range" id="tr" min="1000" max="1000000" step="1000" value="100000" oninput="sy()">
        
        <div style="display:grid; grid-template-columns: 32px 60px 85px 1fr; gap:6px; align-items:center; margin-bottom:6px;">
            <div class="tag">ç›¾</div><div class="u-btn active" id="mI">å‰²åˆ</div><input type="number" id="iI" value="33" oninput="hi('I')"><div id="sI" style="font-size:10px; font-weight:700;"></div>
        </div>
        <div style="display:grid; grid-template-columns: 32px 60px 85px 1fr; gap:6px; align-items:center; margin-bottom:6px;">
            <div class="tag">æ§</div><div class="u-btn active" id="mL">å‰²åˆ</div><input type="number" id="iL" value="33" oninput="hi('L')"><div id="sL" style="font-size:10px; font-weight:700;"></div>
        </div>
        <div style="display:grid; grid-template-columns: 32px 60px 85px 1fr; gap:6px; align-items:center; margin-bottom:6px;">
            <div class="tag">å¼“</div><div class="u-btn active" id="mA">å‰²åˆ</div><input type="number" id="iA" value="34" oninput="hi('A')"><div id="sA" style="font-size:10px; font-weight:700;"></div>
        </div>
    </div>

    <div class="res-box">
        <span style="font-size:10px; font-weight:900;">æ¨å®šåˆè¨ˆãƒ€ãƒ¡ãƒ¼ã‚¸</span>
        <div id="resDmg">0</div>
    </div>

    <div class="best-area">
        <span class="best-txt" id="bT">---</span>
        <span class="best-dmg" id="bDMG">æ¨å¥¨æ™‚ã®æ¨å®šãƒ€ãƒ¡: 0</span>
    </div>

    <button class="reset-btn" onclick="rs()">æ•°å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <div class="log-section">
        <details>
            <summary style="font-size:10px; color:var(--sub-accent); cursor:pointer; font-weight:900;">ğŸ“Š è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª</summary>
            <div class="log" id="log"></div>
        </details>
    </div>
</div>

<script>
const SPREADSHEET_API_URL = "https://script.google.com/macros/s/AKfycbwWEDwwO4vSFzdOkMY6NEbqIrd-DEREvKgUg5YZTFWPODvlVHsPChv5UtlMbM9u_mCD/exec";

const D = {
    ç›¾: {"ãªã—":{T7:[7,7],T8:[8,8],T9:[9,9],T10:[10,10],T11:[12,12]},"1":{T10:[11,10],T11:[13,12]},"2":{T10:[12,11],T11:[14,13]},"3":{T10:[13,12],T11:[15,14]},"4":{T10:[13,13],T11:[15,15]},"5":{T10:[14,13],T11:[16,15]},"6":{T10:[14,13],T11:[17,16]},"7":{T10:[15,14],T11:[17,16]},"8":{T10:[15,15],T11:[18,17]},"9":{T10:[15,14],T11:[18,17]},"10":{T10:[16,15],T11:[19,18]}},
    æ§: {"ãªã—":{T7:[9,10],T8:[10,11],T9:[12,12],T10:[13,14],T11:[15,16]},"1":{T10:[14,15],T11:[16,17]},"2":{T10:[16,16],T11:[18,18]},"3":{T10:[17,17],T11:[19,19]},"4":{T10:[18,18],T11:[20,20]},"5":{T10:[20,19],T11:[22,22]},"6":{T10:[21,20],T11:[23,22]},"7":{T10:[22,21],T11:[24,24]},"8":{T10:[23,22],T11:[25,24]},"9":{T10:[24,22],T11:[27,25]},"10":{T10:[25,23],T11:[28,26]}},
    å¼“: {"ãªã—":{T7:[9,10],T8:[10,11],T9:[12,12],T10:[14,15],T11:[16,17]},"1":{T10:[15,16],T11:[17,18]},"2":{T10:[17,17],T11:[19,19]},"3":{T10:[18,18],T11:[20,20]},"4":{T10:[19,19],T11:[21,21]},"5":{T10:[21,20],T11:[23,22]},"6":{T10:[22,21],T11:[24,23]},"7":{T10:[23,22],T11:[25,24]},"8":{T10:[24,23],T11:[26,25]},"9":{T10:[25,23],T11:[28,26]},"10":{T10:[26,24],T11:[30,27]}}
};

let memberData = { ruby: { tr: 100000, fc: "4", t: "T10" }, junk: { tr: 100000, fc: "5", t: "T11" } };
let currentKey = "ruby"; 
let cur = {I:0, L:0, A:0};

async function it() {
    const fcs = ["ãªã—","1","2","3","4","5","6","7","8","9","10"];
    const tiers = ["T7","T8","T9","T10","T11"];
    document.querySelectorAll('[id^="fc"]').forEach(s => { fcs.forEach(f => s.add(new Option("FC "+f,f))); });
    document.querySelectorAll('select[id^="t"]').forEach(s => { tiers.forEach(t => s.add(new Option(t,t))); });
    
    applySettings();

    try {
        const res = await fetch(SPREADSHEET_API_URL);
        const data = await res.json();
        if(data.ruby) memberData.ruby.tr = data.ruby;
        if(data.junk) memberData.junk.tr = data.junk;
        applySettings();
    } catch (e) { console.error(e); }
}

function applySettings() {
    const conf = memberData[currentKey];
    document.getElementById('tr').value = conf.tr;
    document.querySelectorAll('[id^="fc"]').forEach(s => s.value = conf.fc);
    document.querySelectorAll('select[id^="t"]').forEach(s => s.value = conf.t);
    sy();
}

function toggleEdition() {
    currentKey = (currentKey === "ruby") ? "junk" : "ruby";
    document.body.classList.toggle('junk-theme', currentKey === "junk");
    document.getElementById('editionLabel').innerText = (currentKey === "ruby" ? "ã‚‹ã³ãƒ" : "ã˜ã‚ƒã‚“ã") + "edition";
    applySettings();
}

function sy() {
    const tot = parseInt(document.getElementById('tr').value) || 0;
    document.getElementById('tDisp').innerText = tot.toLocaleString();
    let sumP = 0;
    ['I','L','A'].forEach(t => {
        const pct = parseFloat(document.getElementById('i'+t).value) || 0;
        cur[t] = Math.floor(tot * (pct / 100));
        sumP += pct;
        document.getElementById('s'+t).innerText = `â†’ ${cur[t].toLocaleString()}`;
    });
    document.getElementById('remDisp').innerText = `æ®‹ã‚Šï¼š${Math.round(100-sumP)}%`;
    calc();
}

function hi(t) { sy(); }

function calc() {
    let lb = "<span class='log-head'>1. åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>\n";
    let lc = "<span class='log-head'>2. ãƒãƒ•é©ç”¨ä¿‚æ•°</span>\n";
    let ld = "<span class='log-head'>3. å„å…µç¨®ãƒ€ãƒ¡ãƒ¼ã‚¸</span>\n";
    const tot = parseInt(document.getElementById('tr').value);
    
    const process = (row, key, atkId, kilId) => {
        const fc = document.getElementById('fc'+row).value, t = document.getElementById('t'+row).value,
              b = (D[key][fc] && D[key][fc][t]) ? D[key][fc][t] : D[key]["ãªã—"][t],
              a = parseFloat(document.getElementById(atkId).value)||0, k = parseFloat(document.getElementById(kilId).value)||0;
        const base = b[0] * b[1];
        const coeff = base * (1 + a/100) * (1 + k/100);
        const dmg = Math.sqrt(cur[row.toUpperCase()]) * coeff;
        lb += `${key}(${t}/${fc}): æ”»${b[0]}Ã—å®ˆ${b[1]}=${base}\n`;
        lc += `${key}: ${base}Ã—æ”»ãƒãƒ•Ã—æ®ºãƒãƒ•=ä¿‚æ•°:${coeff.toFixed(1)}\n`;
        ld += `${key}: âˆš${cur[row.toUpperCase()].toLocaleString()}Ã—${coeff.toFixed(1)}=${Math.floor(dmg).toLocaleString()}\n`;
        return {dmg: dmg, m: coeff};
    };

    const rI = process('i','ç›¾','bAi','bKi'), rL = process('l','æ§','bAl','bKl'), rA = process('a','å¼“','bAa','bKa');
    document.getElementById('resDmg').innerText = Math.floor(rI.dmg + rL.dmg + rA.dmg).toLocaleString();
    document.getElementById('log').innerHTML = lb + lc + ld;

    const sQ = rI.m**2 + rL.m**2 + rA.m**2;
    if(sQ > 0) {
        const pI = Math.round(rI.m**2/sQ*100), pL = Math.round(rL.m**2/sQ*100), pA = 100 - pI - pL;
        document.getElementById('bT').innerText = `æ¨å¥¨: ç›¾${pI}% æ§${pL}% å¼“${pA}%`;
        const bDmg = (Math.sqrt(tot * pI/100) * rI.m) + (Math.sqrt(tot * pL/100) * rL.m) + (Math.sqrt(tot * pA/100) * rA.m);
        document.getElementById('bDMG').innerText = `æ¨å¥¨æ™‚ã®æ¨å®šãƒ€ãƒ¡: ${Math.floor(bDmg).toLocaleString()}`;
    }
}

function rs() {
    ['bAi','bKi','bAl','bKl','bAa','bKa'].forEach(id => document.getElementById(id).value="0.0");
    document.getElementById('iI').value=33; document.getElementById('iL').value=33; document.getElementById('iA').value=34;
    applySettings();
}

window.onload = it;
</script>
</body>
</html>
